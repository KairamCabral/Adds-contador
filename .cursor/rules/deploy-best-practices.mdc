---
description: "Boas pr√°ticas para evitar erros de deploy - baseado em erros reais encontrados"
alwaysApply: true
---

# üöÄ BOAS PR√ÅTICAS PARA DEPLOY (VERCEL)

## üìã CHECKLIST PR√â-COMMIT

Antes de fazer commit, SEMPRE verificar:

```bash
# 1. Linter (ESLint)
npm run lint

# 2. Type checking (TypeScript)
npx tsc --noEmit

# 3. Build local
npm run build
```

---

## ‚ùå ERROS COMUNS E COMO EVITAR

### 1Ô∏è‚É£ **Links Internos (`<a>` vs `<Link>`)**

**‚ùå ERRADO:**
```tsx
<a href="/">Home</a>
<a href="/dashboard">Dashboard</a>
```

**‚úÖ CORRETO:**
```tsx
import Link from "next/link";

<Link href="/">Home</Link>
<Link href="/dashboard">Dashboard</Link>
```

**Regra:** NUNCA usar `<a>` para navega√ß√£o interna no Next.js. Sempre usar `<Link>` do `next/link`.

---

### 2Ô∏è‚É£ **Vari√°veis N√£o Utilizadas**

**‚ùå ERRADO:**
```tsx
function Component({ data, unused }: Props) {
  return <div>{data}</div>;
}
```

**‚úÖ CORRETO:**
```tsx
// Op√ß√£o 1: Remover par√¢metro n√£o usado
function Component({ data }: Props) {
  return <div>{data}</div>;
}

// Op√ß√£o 2: Usar underscore se for necess√°rio na interface
function Component({ data, _unused }: Props) {
  return <div>{data}</div>;
}
```

**Regra:** ESLint falha em build se houver vari√°veis/par√¢metros definidos mas n√£o usados.

---

### 3Ô∏è‚É£ **Tipagem TypeScript (`unknown` e Type Assertions)**

**‚ùå ERRADO:**
```tsx
let data = item; // TypeScript infere tipo de 'item'
const apiData = await fetchData(); // retorna 'unknown'
data = apiData; // ERRO: Type 'unknown' is not assignable
```

**‚úÖ CORRETO:**
```tsx
// Op√ß√£o 1: Tipar explicitamente como 'unknown'
let data: unknown = item;
const apiData = await fetchData();
data = apiData; // ‚úÖ OK

// Op√ß√£o 2: Type assertion (use com cuidado)
let data = item;
const apiData = await fetchData() as typeof item;
data = apiData; // ‚úÖ OK
```

**Regra:** Quando uma vari√°vel pode receber valores de tipos diferentes, declare explicitamente como `unknown`.

---

### 4Ô∏è‚É£ **Imports Faltando**

**‚ùå ERRADO:**
```tsx
// Esqueceu de importar Link
export default function Page() {
  return <Link href="/">Home</Link>; // ERRO
}
```

**‚úÖ CORRETO:**
```tsx
import Link from "next/link";

export default function Page() {
  return <Link href="/">Home</Link>;
}
```

**Regra:** Sempre verificar imports ao usar componentes do Next.js (`Link`, `Image`, `useRouter`, etc).

---

### 5Ô∏è‚É£ **Prisma Schema + Build**

**‚ö†Ô∏è ATEN√á√ÉO:**
- Sempre rodar `npx prisma generate` ap√≥s mudar `schema.prisma`
- Build falha se o schema n√£o estiver sincronizado
- `package.json` j√° tem `"postinstall": "prisma generate"` para Vercel

**Comando ap√≥s mudar schema:**
```bash
npx prisma generate
```

---

### 6Ô∏è‚É£ **ESLint Config (`.eslintignore` deprecated)**

**‚ùå OBSOLETO:**
```
# .eslintignore (n√£o funciona mais)
node_modules
.next
```

**‚úÖ CORRETO:**
```javascript
// eslint.config.mjs
export default [
  {
    ignores: ['node_modules/**', '.next/**', 'out/**']
  },
  ...otherConfigs
];
```

**Regra:** Usar `ignores` no `eslint.config.mjs` ao inv√©s de `.eslintignore`.

---

## üîß CONFIGURA√á√ÉO DO PROJETO

### ESLint Strict
```javascript
// eslint.config.mjs
const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    rules: {
      '@next/next/no-html-link-for-pages': 'error', // ‚úÖ Ativo
      '@typescript-eslint/no-unused-vars': 'error',  // ‚úÖ Ativo
    }
  }
];
```

### TypeScript Strict
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

---

## üéØ WORKFLOW RECOMENDADO

### Antes de Commit:
1. ‚úÖ Rodar `npm run lint` (sem erros)
2. ‚úÖ Rodar `npx tsc --noEmit` (sem erros)
3. ‚úÖ Testar localmente (`npm run dev`)
4. ‚úÖ Build local (`npm run build`) se poss√≠vel

### Ap√≥s Commit:
1. üîç Verificar logs do GitHub Actions (se houver)
2. üöÄ Aguardar build da Vercel
3. ‚ö†Ô∏è Se falhar, analisar logs e corrigir

---

## üìù RESUMO DOS ERROS HIST√ìRICOS

| Data | Erro | Causa | Corre√ß√£o |
|------|------|-------|----------|
| 2026-01-15 | `no-html-link-for-pages` | Usado `<a>` ao inv√©s de `<Link>` | Substituir por `<Link>` |
| 2026-01-15 | `no-unused-vars` | Par√¢metro `lastSync` n√£o usado | Remover par√¢metro |
| 2026-01-15 | Type error `unknown` | Tipagem impl√≠cita incorreta | Declarar `contaComDetalhe: unknown` |

---

## üö® REGRAS DE OURO

1. **SEMPRE** usar `<Link>` para navega√ß√£o interna
2. **NUNCA** deixar vari√°veis/imports n√£o utilizados
3. **SEMPRE** tipar explicitamente quando h√° ambiguidade
4. **SEMPRE** testar build local antes de push
5. **NUNCA** commitar com erros de lint/typecheck

---

## üõ†Ô∏è FERRAMENTAS √öTEIS

### VS Code Extensions
- ESLint
- TypeScript and JavaScript Language Features
- Error Lens (mostra erros inline)

### Git Hooks (opcional)
```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm run lint && tsc --noEmit"
    }
  }
}
```

---

**üéØ Objetivo:** Zero erros de build na Vercel!
